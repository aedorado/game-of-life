<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Game of Life</title>
	<link rel="stylesheet" type="text/css" href="style.css">

	<style>

		#container {

		}

/*		.row {
			width: 100%;
		}*/
	
		.left {
			float: left
		}

		.right {
			float: right;
		}
		
		.controls button {
			border: none;
			color: white;
			background-color: black;
			width: 80px;
			height: 20px;
		}

		.controls button:hover {
			cursor: pointer;
		}

		.alive {
			background-color: red;
		}

		.cell-standard {
			border: 1px solid #ddd;
			display: inline-block;
			margin: 0px;
			float: left;
			height: 10px;
			width: 10px;
		}

		.cell-small {
			border: 1px solid red;
			height: 12px;
			width: 12px;
		}

		.cell-medium {
			border: 1px solid red;
			height: 10px;
			width: 10px;
		}

		.cell-large {
			border: 1px solid red;
			height: 9px;
			width: 9px;
		}

		#game-container {
			position: relative;
			margin-top: 32px;
			/*border: 1px solid black;*/
			width: 100%;
		}


	</style>

	<script src="react/react.js"></script>
    <script src="react/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
</head>
<body>

	<div class="row" id="container">
		<div class="controls">
			<span class="" id="controls-size">Size : 
				<button id="controls-size-small">SMALL</button>
				<button id="controls-size-med">MEDIUM</button>
				<button id="controls-size-large">LARGE</button>
			</span>
			<span class="" id="controls-speed">Speed: 
				<button id="controls-speed-fast">FAST</button>
				<button id="controls-speed-med">MEDIUM</button>
				<button id="controls-speed-slow">SLOW</button>
			</span>
		</div>

		<div id="game-container">
			
		</div>
	</div>


</body>

<script type="text/babel">

	var small = {
			rows: 50,
			cols: 30,
			alive: 375
		};

	var med = {
			rows: 60,
			cols: 40,
			alive: 600
		};

	var large = {
			rows: 70,
			cols: 50,
			alive: 875
		};

	var SizeEnum = {
		SMALL: 's',
		MEDIUM: 'm',
		LARGE: 'l'
	};

	var SpeedEnum = {
		SLOW: 1,
		MEDIUM: 2,
		FAST: 3
	}

	var speed = SpeedEnum.MEDIUM;
	var size = SizeEnum.MEDIUM;
	var sizeclass = med;

	var Board = React.createClass({
		getInitialState: function() {
			return {
			  bsize: size	// global var size
			};
		},

		changeBoardSize: function(e) {
			switch(e.target.id) {
				case 'controls-size-small':
					size = SizeEnum.SMALL;	// global vars
					sizeclass = small;		// size & sizeclass
					break;
				case 'controls-size-med':
					size = SizeEnum.MEDIUM;
					sizeclass = med;
					break;
				case 'controls-size-large':
					size = SizeEnum.LARGE;
					sizeclass = large;
					break;
			}
			this.setState({
				bsize: size
			});
		},

	  componentDidMount: function() {
	    var that = this;
	    document.getElementById("controls-size-small").addEventListener('click', that.changeBoardSize, false);
	    document.getElementById("controls-size-med").addEventListener('click', that.changeBoardSize, false);
	    document.getElementById("controls-size-large").addEventListener('click', that.changeBoardSize, false);
	  },

	  render: function() {
	    var style = {};
	    if (this.state.bsize === SizeEnum.SMALL) {
	      style = {
	        width: 600 + 'px',
	        height: 360 + 'px',
	        margin: 'auto',
	        border: '2px solid red'
	      }
	    } else if (this.state.bsize === SizeEnum.MEDIUM) {
	      style = {
	        width: 720 + 'px',
	        height: 480 + 'px',
	        margin: 'auto',
	        border: '2px solid red'
	      }
	    } else if (this.state.bsize === SizeEnum.LARGE) {
	      style = {
	        width: 840 + 'px',
	        height: 600 + 'px',
	        margin: 'auto',
	        border: '2px solid red'
	      }
	    }
	    console.log(this.state.bsize);
	    return (<div style={style}><Cells size={this.state.bsize} /></div>);
	  }
	});

	var Cells = React.createClass({

		getInitialState: function() {
			console.log('cells initial ' + this.props.size);
			if (this.props.size === SizeEnum.SMALL) {
				return small;	// global var
			} else if (this.props.size === SizeEnum.MEDIUM) {
				return med;		// global var
			} else if (this.props.size === SizeEnum.LARGE) {
				return large;	// global var
			} else {
				return null;
			}
		},

		render: function() {
			var cells = [];
			console.log(this.props.size);
			console.log(this.state);
			actionBoard = randomBoard();	console.log(actionBoard);
			for (var i = 0; i < this.state.rows; i++) {
				for (var j = 0; j < this.state.cols; j++) {
					cells.push(<Cell rowid={i} colid={j} key={parseInt((i * 10) + '' + j)} />);
				}
			}

			return (
				<div>{cells}</div>
			);

		}
	});

	var Cell = React.createClass({

		cellClicked: function() {

		},

		render: function() {
			var className = "cell-standard";
			if (actionBoard[this.props.rowid][this.props.colid] == 1) {
				className += " alive";
				// console.log('Alive @ ' + this.props.rowid + ',' + this.props.colid);
			}
			return (
				<div className={className} onClick={this.cellClicked}></div>
			)
		}
	});

	function randomUpto(max) {
		return Math.ceil(Math.random() * (max - 1));
	}

	function randomBoard() {
		console.log(size);
		var localboard = [];

		for (var i = 0; i < sizeclass.rows; i++) {
			localboard.push(Array.apply(null, Array(sizeclass.cols)).map(Number.prototype.valueOf, 0));
		}

		for (var i = 1; i <= sizeclass.alive; i++) {
			localboard[randomUpto(sizeclass.rows)][randomUpto(sizeclass.cols)] = 1;
			// localboard[r][c] = 1;
		}

		return localboard;
	}

	function nextGen() {

		function edgecell(x, y) {
			if (x == 0 && y == 0) {
				return true;
			} else if (x == 0 && y == (sizeclass.cols - 1)) {
				return true;
			} else if (x == (sizeclass.rows - 1) && y == 0) {
				return true;
			} else if (x == (sizeclass.rows - 1) && y == (sizeclass.cols - 1)) {
				return true;
			}
			return false;
		}

		function cornercell(x, y) {
			if (x == 0 || y == 0 || x == (sizeclass.rows - 1) || y == (sizeclass.cols - 1)) {
				return true;
			}
			return false;
		}

		function alive(x, y) {
			return (actionBoard[x][y] == 1);
		}


		var newboard = actionBoard.slice();
		for (var i = 0; i < sizeclass.rows; i++) {
			for (var j = 0; j < sizeclass.cols; j++) {
				var nbours;
				if (cornercell(i, j)) {

				} else if (edgecell(i, j)) {

				} else {
					nbours = actionBoard[i - 1][j - 1] + actionBoard[i - 1][j] 	+ actionBoard[i - 1][j + 1] +
							   actionBoard[i][j - 1] + 							+ 	actionBoard[i][j + 1] +
							 actionBoard[i + 1][j - 1] + actionBoard[i + 1][j]	+ actionBoard[i + 1][j + 1];
				}

				if (nbours <= 1 || nbours >= 4) {	// death by loneliness or overcrowding
					newboard[i][j] = 0;
				} else if (alive(i, j)) {
					newboard[i][j] = 1;
				} else if (!alive(i, j) && nbours == 3) {
					newboard[i][j] = 1;
				}

			}
		}

		return newboard;
	}

	var actionBoard = randomBoard();

	ReactDOM.render(<Board />, document.getElementById("game-container"));

	setInterval(function() {
		actionBoard = nextGen();
		ReactDOM.render(<Board />, document.getElementById("game-container"));
	}, 1000);

</script>

</html>