<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Game of Life</title>

	<style>

		#container {

		}
	
		.left {
			float: left
		}

		.right {
			float: right;
		}
		
		.controls button {
			border: none;
			color: white;
			background-color: black;
			width: 80px;
			height: 20px;
		}

		.controls button:hover {
			cursor: pointer;
		}

		.alive {
			background-color: red;
			border: 1px solid #ddd;
		}

		.dead {
			border: 1px solid #ddd;
		}

		.cell-standard {
			display: inline-block;
			margin: 0px;
			float: left;
			height: 11px;
			width: 11px;
			border-left: 0px;
			border-top: 0px;
		}

		.cell-small {
			border: 1px solid red;
			height: 12px;
			width: 12px;
		}

		.cell-medium {
			border: 1px solid red;
			height: 10px;
			width: 10px;
		}

		.cell-large {
			border: 1px solid red;
			height: 9px;
			width: 9px;
		}

		#game-container {
			position: relative;
			margin-top: 32px;
			/*border: 1px solid black;*/
			width: 100%;
		}


	</style>

	<script src="react/react.js"></script>
    <script src="react/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
</head>
<body>

	<div class="row" id="container">
		<div class="controls">
			<span class="" id="controls-size">Size : 
				<button class="control-size-button" id="controls-size-small">SMALL</button>
				<button class="control-size-button" id="controls-size-med">MEDIUM</button>
				<button class="control-size-button" id="controls-size-large">LARGE</button>
			</span>
			<span class="" id="controls-speed">Speed: 
				<button class="control-speed-button" id="controls-speed-fast">FAST</button>
				<button class="control-speed-button" id="controls-speed-med">MEDIUM</button>
				<button class="control-speed-button" id="controls-speed-slow">SLOW</button>
			</span>
		</div>

		<div id="game-container">
			
		</div>
	</div>


</body>

<script type="text/babel">

	var small = {
			rows: 30,
			cols: 50,
			alive: 375
		};

	var med = {
			rows: 40,
			cols: 60,
			alive: 600
		};

	var large = {
			rows: 50,
			cols: 70,
			alive: 875
		};

	var SizeEnum = {
		SMALL: 's',
		MEDIUM: 'm',
		LARGE: 'l'
	};

	var SpeedEnum = {
		SLOW: 1000,
		MEDIUM: 350,
		FAST: 150
	}

	var speed = SpeedEnum.MEDIUM;
	var size = SizeEnum.MEDIUM;
	var sizeclass = med;


	document.getElementById("controls-speed-slow").addEventListener('click', changeSpeed, false);
	document.getElementById("controls-speed-med").addEventListener('click', changeSpeed, false);
	document.getElementById("controls-speed-fast").addEventListener('click', changeSpeed, false);

	function changeSpeed(e) {
		switch (e.target.id) {
			case 'controls-speed-fast':
				speed = SpeedEnum.FAST;
				break;
			case 'controls-speed-med':
				speed = SpeedEnum.MEDIUM;
				break;
			case 'controls-speed-slow':
				speed = SpeedEnum.SLOW;
				break;
		}
		console.log(speed);
	}

	var Board = React.createClass({
		getInitialState: function() {
			return {
			  bsize: size	// global var size
			};
		},

		changeBoardSize: function(e) {
			switch(e.target.id) {
				case 'controls-size-small':
					size = SizeEnum.SMALL;	// global vars
					sizeclass = small;		// size & sizeclass
					break;
				case 'controls-size-med':
					size = SizeEnum.MEDIUM;
					sizeclass = med;
					break;
				case 'controls-size-large':
					size = SizeEnum.LARGE;
					sizeclass = large;
					break;
			}
			this.setState({
				bsize: size
			});
		},

	  componentDidMount: function() {
	    var that = this;
	    document.getElementById("controls-size-small").addEventListener('click', that.changeBoardSize, false);
	    document.getElementById("controls-size-med").addEventListener('click', that.changeBoardSize, false);
	    document.getElementById("controls-size-large").addEventListener('click', that.changeBoardSize, false);
	  },

	  render: function() {
	    var style = {};
	    if (this.state.bsize === SizeEnum.SMALL) {
	      style = {
	        height: 360 + 'px',
	        width: 600 + 'px',
	        margin: 'auto',
	        border: '2px solid #ddd'
	      }
	    } else if (this.state.bsize === SizeEnum.MEDIUM) {
	      style = {
	        height: 480 + 'px',
	        width: 720 + 'px',
	        margin: 'auto',
	        border: '2px solid #ddd'
	      }
	    } else if (this.state.bsize === SizeEnum.LARGE) {
	      style = {
	        height: 600 + 'px',
	        width: 840 + 'px',
	        margin: 'auto',
	        border: '2px solid #ddd'
	      }
	    }
	    return (<div style={style}><Cells size={this.state.bsize} /></div>);
	  }
	});

	var Cells = React.createClass({

		getInitialState: function() {
			if (this.props.size === SizeEnum.SMALL) {
				return small;	// global var
			} else if (this.props.size === SizeEnum.MEDIUM) {
				return med;		// global var
			} else if (this.props.size === SizeEnum.LARGE) {
				return large;	// global var
			} else {
				return null;
			}
		},

		render: function() {
			var cells = [];
			for (var i = 0; i < this.state.rows; i++) {
				for (var j = 0; j < this.state.cols; j++) {
					cells.push(<Cell rowid={i} colid={j} key={parseInt((i * 10) + '' + j)} />);
				}
			}

			return (
				<div>{cells}</div>
			);

		}
	});

	var Cell = React.createClass({

		getInitialState: function() {
			if (actionBoard[this.props.rowid][this.props.colid] == 1) {
				return {
					alive: true
				};
			} else {
				return {
					alive: false
				};
			}
		},

		cellClicked: function() {
			if (this.state.alive) {
				actionBoard[this.props.rowid][this.props.colid] = 0;
				this.setState({
					alive: false
				});
			} else {
				actionBoard[this.props.rowid][this.props.colid] = 1;
				this.setState({
					alive: true
				});
			}
		},

		render: function() {
			var className = "cell-standard";
			if (actionBoard[this.props.rowid][this.props.colid] == 1) {
				className += " alive";
			} else {
				className += " dead";
			}

			return (
				<div className={className} onClick={this.cellClicked}></div>
			)
		}
	});

	function randomUpto(max) {
		return Math.ceil(Math.random() * (max - 1));
	}

	function randomBoard() {
		var localboard = [];
		for (var i = 0; i < sizeclass.rows; i++) {
			localboard.push(Array.apply(null, Array(sizeclass.cols)).map(Number.prototype.valueOf, 0));
		}
		for (var i = 1; i <= sizeclass.alive; i++) {
			localboard[randomUpto(sizeclass.rows)][randomUpto(sizeclass.cols)] = 1;
		}
		return localboard;
	}

	function nextGen() {

		function edgecell(x, y) {
			if (x == 0 && y == 0) {
				return true;
			} else if (x == 0 && y == (sizeclass.cols - 1)) {
				return true;
			} else if (x == (sizeclass.rows - 1) && y == 0) {
				return true;
			} else if (x == (sizeclass.rows - 1) && y == (sizeclass.cols - 1)) {
				return true;
			}
			return false;
		}

		function cornercell(x, y) {
			if (x == 0 || y == 0 || x == (sizeclass.rows - 1) || y == (sizeclass.cols - 1)) {
				return true;
			}
			return false;
		}

		function alive(x, y) {
			return (actionBoard[x][y] == 1);
		}


		var newboard = [];
		for (var i = 0; i < sizeclass.rows; i++) {
			newboard.push(Array.apply(null, Array(sizeclass.cols)).map(Number.prototype.valueOf, 0));
		}

		for (var i = 0; i < sizeclass.rows; i++) {
			for (var j = 0; j < sizeclass.cols; j++) {
				var nbours;
				if (cornercell(i, j)) {

				} else if (edgecell(i, j)) {

				} else {
					nbours = actionBoard[i - 1][j - 1] + actionBoard[i - 1][j] 	+ actionBoard[i - 1][j + 1] +
							   actionBoard[i][j - 1] + 							 	actionBoard[i][j + 1] +
							 actionBoard[i + 1][j - 1] + actionBoard[i + 1][j]	+ actionBoard[i + 1][j + 1];
					// console.log(i, j, nbours);
					// console.log(actionBoard[i - 1][j - 1] , actionBoard[i - 1][j] 	, actionBoard[i - 1][j + 1] ,
							   // actionBoard[i][j - 1] , 							 	actionBoard[i][j + 1] ,
							 // actionBoard[i + 1][j - 1] , actionBoard[i + 1][j]	, actionBoard[i + 1][j + 1]);
				}

				// console.log('before = ' + actionBoard[i][j]);
				if (nbours <= 1 || nbours >= 4) {	// death by loneliness or overcrowding
					newboard[i][j] = 0;
				} else if (alive(i, j)) {	// stayin' alive
					newboard[i][j] = 1;
				} else if (!alive(i, j) && nbours == 3) {	// birth
					newboard[i][j] = 1;
				}
				// console.log('after = ' + actionBoard[i][j], 'after newboard = ' + newboard[i][j]);
			}
		}
		// console.log(newboard);
		return newboard;
	}

	var actionBoard = randomBoard();

	ReactDOM.render(<Board />, document.getElementById("game-container"));

	var t;
	function runGeneration() {
		t = setTimeout(function() {
				actionBoard = nextGen();
				ReactDOM.render(<Board />, document.getElementById("game-container"));
				runGeneration();
			}, speed);
	}

	runGeneration();

</script>

</html>